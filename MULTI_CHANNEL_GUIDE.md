# ğŸš€ å¤šé¢‘é“æ˜ å°„åŠŸèƒ½ä½¿ç”¨æŒ‡å—

## ğŸ“‹ åŠŸèƒ½æ¦‚è¿°

æ–°çš„å¤šé¢‘é“æ˜ å°„åŠŸèƒ½å…è®¸ä½ çš„BotåŒæ—¶ç›‘æ§å¤šä¸ªæºé¢‘é“ï¼Œå¹¶å°†å†…å®¹è½¬å‘åˆ°å¯¹åº”çš„ç›®æ ‡é¢‘é“ã€‚æ¯ä¸ªé¢‘é“æ˜ å°„å¯ä»¥æœ‰ç‹¬ç«‹çš„è®¾ç½®ï¼ŒåŒ…æ‹¬captionå¤„ç†ã€å»¶è¿Ÿé…ç½®ç­‰ã€‚

## ğŸ¯ åº”ç”¨åœºæ™¯

- **æ–°é—»èšåˆ**: ä»å¤šä¸ªæ–°é—»æºè½¬å‘åˆ°ä¸åŒçš„åˆ†ç±»é¢‘é“
- **å†…å®¹åˆ†å‘**: ä¸€ä¸ªæœºå™¨äººç®¡ç†å¤šä¸ªä¸»é¢˜é¢‘é“
- **å¤‡ä»½ç³»ç»Ÿ**: ä¸ºæ¯ä¸ªé‡è¦é¢‘é“åˆ›å»ºå¤‡ä»½
- **å†…å®¹è¿‡æ»¤**: ä¸åŒæºé¢‘é“ä½¿ç”¨ä¸åŒçš„captionè§„åˆ™

## âš™ï¸ é…ç½®æ–¹å¼

### æ–¹æ³•1: ç¯å¢ƒå˜é‡å¯ç”¨

åœ¨ `.env` æ–‡ä»¶ä¸­æ·»åŠ ï¼š

```env
# å¯ç”¨å¤šé¢‘é“æ¨¡å¼
MULTI_CHANNEL_ENABLED=true
CHANNELS_CONFIG_FILE=channels.json
```

### æ–¹æ³•2: åˆ›å»ºchannels.jsoné…ç½®æ–‡ä»¶

```json
{
  "channels": [
    {
      "id": "tech_news",
      "name": "ç§‘æŠ€èµ„è®¯è½¬å‘",
      "source_channel": "@tech_source_channel", 
      "target_channel": "@my_tech_channel",
      "enabled": true,
      "description": "ç§‘æŠ€æ–°é—»ä»å…¬å…±é¢‘é“è½¬å‘åˆ°æˆ‘çš„é¢‘é“",
      "settings": {
        "fixed_caption": null,
        "append_caption": "\n\nğŸ”” ç§‘æŠ€èµ„è®¯ | å…³æ³¨è·å–æ›´å¤š",
        "delay_enabled": true,
        "min_delay": 1.0,
        "max_delay": 5.0
      }
    },
    {
      "id": "entertainment",
      "name": "å¨±ä¹å†…å®¹è½¬å‘",
      "source_channel": "@entertainment_source",
      "target_channel": "-1001234567890",
      "enabled": true, 
      "description": "å¨±ä¹å†…å®¹è½¬å‘åˆ°ç§å¯†ç¾¤ç»„",
      "settings": {
        "fixed_caption": "ğŸ¬ å¨±ä¹èµ„è®¯",
        "append_caption": null,
        "delay_enabled": true,
        "min_delay": 2.0,
        "max_delay": 8.0
      }
    },
    {
      "id": "news_backup",
      "name": "æ–°é—»å¤‡ä»½",
      "source_channel": "-1009876543210",
      "target_channel": "@my_news_backup", 
      "enabled": false,
      "description": "æ–°é—»é¢‘é“å¤‡ä»½ï¼ˆæš‚æ—¶ç¦ç”¨ï¼‰",
      "settings": {
        "fixed_caption": null,
        "append_caption": "\n\nğŸ“° æ–°é—»å¤‡ä»½",
        "delay_enabled": false,
        "min_delay": 1.0,
        "max_delay": 3.0
      }
    }
  ],
  "global_settings": {
    "max_concurrent_channels": 5,
    "default_enabled": true,
    "auto_create_folders": true,
    "log_channel_activity": true,
    "fallback_to_single_channel": true
  }
}
```

## ğŸ® ç®¡ç†å‘½ä»¤

### ğŸ“‹ æŸ¥çœ‹é¢‘é“åˆ—è¡¨
```
/list_channels
```
æ˜¾ç¤ºæ‰€æœ‰é…ç½®çš„é¢‘é“æ˜ å°„ï¼ŒåŒ…æ‹¬çŠ¶æ€ã€æºé¢‘é“ã€ç›®æ ‡é¢‘é“ç­‰ä¿¡æ¯ã€‚

### â• æ·»åŠ æ–°é¢‘é“æ˜ å°„
```
/add_channel <ID> <åç§°> <æºé¢‘é“> <ç›®æ ‡é¢‘é“> [æè¿°]
```

**ç¤ºä¾‹:**
```
/add_channel tech_news ç§‘æŠ€èµ„è®¯ @tech_source @my_tech ç§‘æŠ€æ–°é—»è½¬å‘
/add_channel ent_news å¨±ä¹èµ„è®¯ @ent_source -1001234567890 å¨±ä¹å†…å®¹è½¬å‘
```

### âŒ åˆ é™¤é¢‘é“æ˜ å°„
```
/remove_channel <ID>
```

**ç¤ºä¾‹:**
```
/remove_channel tech_news
```

### ğŸ”„ åˆ‡æ¢é¢‘é“çŠ¶æ€
```
/toggle_channel <ID>
```
åœ¨å¯ç”¨/ç¦ç”¨ä¹‹é—´åˆ‡æ¢é¢‘é“æ˜ å°„çŠ¶æ€ã€‚

**ç¤ºä¾‹:**
```
/toggle_channel tech_news
```

## ğŸ”§ é…ç½®å‚æ•°è¯´æ˜

### é¢‘é“æ˜ å°„å­—æ®µ

| å­—æ®µ | å¿…éœ€ | è¯´æ˜ | ç¤ºä¾‹ |
|------|------|------|------|
| `id` | âœ… | å”¯ä¸€æ ‡è¯†ç¬¦ | `"tech_news"` |
| `name` | âœ… | æ˜¾ç¤ºåç§° | `"ç§‘æŠ€èµ„è®¯è½¬å‘"` |
| `source_channel` | âœ… | æºé¢‘é“ID | `"@tech_source"` æˆ– `"-1001234567890"` |
| `target_channel` | âœ… | ç›®æ ‡é¢‘é“ID | `"@my_tech"` æˆ– `"-1001234567890"` |
| `enabled` | âŒ | æ˜¯å¦å¯ç”¨ | `true` (é»˜è®¤) |
| `description` | âŒ | æè¿°ä¿¡æ¯ | `"ç§‘æŠ€æ–°é—»è½¬å‘"` |
| `settings` | âŒ | é¢‘é“ç‰¹å®šè®¾ç½® | è§ä¸‹æ–¹è¯´æ˜ |

### é¢‘é“ç‰¹å®šè®¾ç½® (settings)

| å­—æ®µ | è¯´æ˜ | ç¤ºä¾‹ |
|------|------|------|
| `fixed_caption` | å›ºå®šcaptionï¼ˆæ›¿æ¢åŸå†…å®¹ï¼‰ | `"ğŸ”¥ çƒ­é—¨èµ„è®¯"` |
| `append_caption` | è¿½åŠ captionï¼ˆåœ¨åŸå†…å®¹åï¼‰ | `"\n\nğŸ“¢ å…³æ³¨è·å–æ›´å¤š"` |
| `delay_enabled` | æ˜¯å¦å¯ç”¨å»¶è¿Ÿ | `true` |
| `min_delay` | æœ€å°å»¶è¿Ÿ(ç§’) | `1.0` |
| `max_delay` | æœ€å¤§å»¶è¿Ÿ(ç§’) | `5.0` |

## ğŸš¦ å·¥ä½œæµç¨‹

1. **æ¶ˆæ¯æ¥æ”¶**: Botæ¥æ”¶åˆ°æºé¢‘é“çš„æ–°æ¶ˆæ¯
2. **é¢‘é“åŒ¹é…**: æ ¹æ®æºé¢‘é“IDæŸ¥æ‰¾å¯¹åº”çš„é¢‘é“æ˜ å°„
3. **çŠ¶æ€æ£€æŸ¥**: ç¡®è®¤é¢‘é“æ˜ å°„å·²å¯ç”¨
4. **è®¾ç½®åº”ç”¨**: åº”ç”¨é¢‘é“ç‰¹å®šçš„captionå’Œå»¶è¿Ÿè®¾ç½®
5. **å†…å®¹è½¬å‘**: å°†å¤„ç†åçš„å†…å®¹å‘é€åˆ°ç›®æ ‡é¢‘é“

## ğŸ¨ Captionå¤„ç†ä¼˜å…ˆçº§

1. **é¢‘é“ç‰¹å®šè®¾ç½®** (channels.jsonä¸­çš„settings)
2. **å…¨å±€è®¾ç½®** (é€šè¿‡å‘½ä»¤è®¾ç½®çš„fixed_caption/append_caption)
3. **åŸå§‹å†…å®¹** (æºæ¶ˆæ¯çš„åŸå§‹æ–‡æœ¬/caption)

## ğŸ“Š å…¼å®¹æ€§

### å‘åå…¼å®¹
- å½“ `MULTI_CHANNEL_ENABLED=false` æ—¶ï¼ŒBotç»§ç»­ä½¿ç”¨ä¼ ç»Ÿçš„å•é¢‘é“æ¨¡å¼
- ç°æœ‰çš„ `.env` é…ç½®(SOURCE_CHANNEL_ID, TARGET_CHANNEL_ID)ä»ç„¶æœ‰æ•ˆ

### æ··åˆæ¨¡å¼
- å¦‚æœå¯ç”¨å¤šé¢‘é“ä½†æ²¡æœ‰æ‰¾åˆ° `channels.json`ï¼Œä¼šè‡ªåŠ¨åˆ›å»ºåŒ…å«ä¼ ç»Ÿé…ç½®çš„é»˜è®¤æ–‡ä»¶

## ğŸ› æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

**1. Botæ²¡æœ‰å“åº”æŸä¸ªé¢‘é“çš„æ¶ˆæ¯**
- æ£€æŸ¥é¢‘é“æ˜ å°„æ˜¯å¦å¯ç”¨: `/list_channels`
- ç¡®è®¤æºé¢‘é“IDæ ¼å¼æ­£ç¡® (ä»¥@æˆ–-å¼€å¤´)
- éªŒè¯Botæ˜¯å¦å·²æ·»åŠ åˆ°æºé¢‘é“

**2. æ¶ˆæ¯è½¬å‘å¤±è´¥**
- æ£€æŸ¥ç›®æ ‡é¢‘é“IDæ˜¯å¦æ­£ç¡®
- ç¡®è®¤Botåœ¨ç›®æ ‡é¢‘é“æœ‰å‘é€æ¶ˆæ¯æƒé™
- æŸ¥çœ‹Botæ—¥å¿—è·å–è¯¦ç»†é”™è¯¯ä¿¡æ¯

**3. Captionè®¾ç½®ä¸ç”Ÿæ•ˆ**
- æ£€æŸ¥é¢‘é“ç‰¹å®šè®¾ç½®æ˜¯å¦æ­£ç¡®é…ç½®
- ç¡®è®¤è®¾ç½®ä¼˜å…ˆçº§ (é¢‘é“ç‰¹å®š > å…¨å±€ > åŸå§‹)

### æ—¥å¿—æŸ¥çœ‹
```bash
pm2 logs mytestxiazai-bot --lines 50
```

## ğŸ“ æœ€ä½³å®è·µ

1. **IDå‘½å**: ä½¿ç”¨æœ‰æ„ä¹‰çš„IDåç§°ï¼Œå¦‚ `tech_news`, `ent_backup`
2. **æè¿°ä¿¡æ¯**: ä¸ºæ¯ä¸ªæ˜ å°„æ·»åŠ æ¸…æ™°çš„æè¿°
3. **å»¶è¿Ÿè®¾ç½®**: æ ¹æ®é¢‘é“ç±»å‹è°ƒæ•´å»¶è¿Ÿï¼Œé¿å…è¢«é™åˆ¶
4. **å®šæœŸå¤‡ä»½**: å®šæœŸå¤‡ä»½ `channels.json` é…ç½®æ–‡ä»¶
5. **æƒé™ç®¡ç†**: ç¡®ä¿Botåœ¨æ‰€æœ‰ç›¸å…³é¢‘é“éƒ½æœ‰æ­£ç¡®æƒé™

## ğŸ”„ ä»å•é¢‘é“è¿ç§»

å¦‚æœä½ ç›®å‰ä½¿ç”¨å•é¢‘é“æ¨¡å¼ï¼Œè¿ç§»åˆ°å¤šé¢‘é“å¾ˆç®€å•ï¼š

1. åœ¨ `.env` ä¸­è®¾ç½® `MULTI_CHANNEL_ENABLED=true`
2. é‡å¯Bot - ä¼šè‡ªåŠ¨åˆ›å»ºåŒ…å«ç°æœ‰é…ç½®çš„ `channels.json`
3. ä½¿ç”¨ç®¡ç†å‘½ä»¤æ·»åŠ æ›´å¤šé¢‘é“æ˜ å°„

åŸæœ‰çš„å•é¢‘é“é…ç½®ä¼šè‡ªåŠ¨è½¬æ¢ä¸ºç¬¬ä¸€ä¸ªé¢‘é“æ˜ å°„ï¼ŒIDä¸º `"default"`ã€‚

## ğŸ¯ é«˜çº§ç”¨æ³•

### å†…å®¹åˆ†ç±»è½¬å‘
```json
{
  "id": "news_classifier",
  "settings": {
    "append_caption": "\n\nğŸ“° #æ–°é—» #å®æ—¶èµ„è®¯"
  }
}
```

### å¤‡ä»½é¢‘é“
```json
{
  "id": "backup_channel", 
  "settings": {
    "fixed_caption": "ğŸ“ å¤‡ä»½å†…å®¹",
    "delay_enabled": false
  }
}
```

### VIPé¢‘é“ (å¿«é€Ÿè½¬å‘)
```json
{
  "id": "vip_channel",
  "settings": {
    "append_caption": "\n\nâ­ VIPä¸“äº«å†…å®¹",
    "min_delay": 0.5,
    "max_delay": 1.0
  }
}
```

---

ğŸ‰ ç°åœ¨ä½ å¯ä»¥ä½¿ç”¨å¼ºå¤§çš„å¤šé¢‘é“æ˜ å°„åŠŸèƒ½æ¥ç®¡ç†å¤æ‚çš„å†…å®¹è½¬å‘éœ€æ±‚äº†ï¼
